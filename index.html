<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>شقق للإيجار والبيع - IskanHub</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="header-container"></div>

  <div class="container" id="apartments"></div>
  <script src="config.js"></script>
  <script>
    
    const container = document.getElementById('apartments');

    // Fetch apartments from API
    async function loadApartments() {
      try {
        //const response = await fetch('https://x8ki-letl-twmt.n7.xano.io/api:pcPw3c4T/apartment');
        const response = await fetch(`${CONFIG.BASE_URL}/apartment`);
        const apartments = await response.json();

        apartments.forEach(apartment => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <img src="${apartment.img || 'https://via.placeholder.com/400x250?text=Apartment'}" alt="${apartment.title}">
            <div class="card-body">
              <h3>${apartment.title}</h3>
              <p><strong>السعر:</strong> ${apartment.price} JOD</p>
              <p><strong>الموقع:</strong> ${apartment.city || 'غير محدد'}</p>
            </div>
            <div class="card-footer">
              <button class="btn btn-secondary" onclick="showDetails(${apartment.id})">عرض التفاصيل</button>
              <button class="btn btn-primary" onclick="reserve(${apartment.id})">احجز موعد</button>
            </div>
          `;
          container.appendChild(card);
        });
      } catch (error) {
        console.error('حدث خطأ عند جلب الشقق:', error);
        container.innerHTML = '<p>فشل تحميل الشقق. حاول لاحقاً.</p>';
      }
    }
    async function loadHeader() {
  try {
    const response = await fetch("header.html?nocache=" + Date.now());
    if (!response.ok) throw new Error("HTTP " + response.status);
    const headerHTML = await response.text();
    document.getElementById("header-container").innerHTML = headerHTML;
  } catch (err) {
    console.error("Error loading header:", err);
    document.getElementById("header-container").innerHTML = "<p>تعذر تحميل القائمة</p>";
  }
}
    loadHeader();

    loadApartments();

    function reserve(id) {
      alert(`تم استلام طلب حجز موعد لزيارة الشقة رقم: ${id}`);
      // Later: integrate form or WhatsApp/phone
    }

    function showDetails(id) {
      // Redirect to the details page with apartment ID in query
      window.location.href = `apartment-details.html?id=${id}`;
    }
  </script>
</body>
</html>